FROM node:18-slim

WORKDIR /app

# Copy everything at once to simplify
COPY . .

# Install dependencies with minimal output and increased memory
ENV NODE_OPTIONS="--max-old-space-size=4096"
RUN npm install --omit=dev --no-fund --no-audit --loglevel=error

# Build the application
RUN npm run build

# Expose the port the app runs on
EXPOSE 3000

# Start the application
CMD ["node", "server.js"]
